# **<u>创建订单</u>**
#### ● **请求地址**
https://epay.jylt.cc/api/createOrder

#### ● **请求方式**
GET/POST

#### ● **参数说明**
| **参数** | **参数类型** | **参数说明** |
| --- | --- | --- |
| mchId | 字符串 | 【必传】商户id |
| payId | 字符串 | 【必传】商户支付单号，可以是时间戳，不可重复，长度最大50个字符 |
| type | 整数 | 【必传】微信支付传入1 支付宝支付传入2 |
| price | 小数 | 【必传】订单金额 |
| sign | 字符串 | 【必传】签名，计算方式为 md5(payId+param+type+price+通讯密钥)（注：如过不知道如何进行md5加密，请使用下面生成签名接口获取签名） |
| goodsName | 字符串 | 【必传】商品名，长度最大50个字符 |
| param | 字符串 | 【可选】传输参数，将会原样返回到异步和同步通知接口 |
| isHtml | 整数 | 【可选】0：返回订单json数据；1：跳转到支付页面如果该参数为1，易支付响应的数据只有跳转页面的url地址，开发者可以通过 window.location.href来进行跳转 |
| notifyUrl | 字符串 | 【可选】当前订单支付成功后的异步回调地址；如果不填，则使用在易支付管理平台填写的异步回调地址（最多200字符） |
| returnUrl | 字符串 | 【可选】如果isHtml=1，当前订单支付成功后跳转的页面地址；如果不填，则使用在以支付管理平台填写的同步回调地址（最多200字符） |


#### ● **返回数据（示例）**
```plain
{
    "code": 1,
    "msg": "成功",
    "data": {
        "payId": "1547129707139",
        "orderId": "201901102220147500",
        "payType": 2,
        "price": 0.1,
        "reallyPrice": 0.1,
        "payUrl": "HTTPS://QR.ALIPAY.COM/FKX03500Z2ZYWA0ELYUB5D",
        "isAuto": 1,
        "state": 0,
        "timeOut": 5,
        "date": 1547130014777
    }
}
```

#### ● **返回数据说明**
| **返回参数** | **参数形式** | **说明** |
| --- | --- | --- |
| code | 整数 | 返回代码（1：成功，-1：调用失败） |
| msg | 字符串 | api调用结果说明 |
| data | array | 如果code=-1，data为null |
| data.payId | 字符串 | 商户支付单号 |
| data.orderId | 字符串 | 云端订单号，可用于查询订单是否支付成功 |
| data.payType | 整数 | 微信支付为1 支付宝支付为2 |
| data.price | 小数 | 订单金额 |
| data.reallyPrice | 小数 | 实际支付金额 |
| data.payUrl | 字符串 | 支付二维码图片url（如果url中含有\u003d，请将该字符替换为=） |
| data.isAuto | 整数 | 1需要手动输入金额 0扫码后自动输入金额 |
| data.state | 整数 | -1：订单过期 0：等待支付 1：支付成功 2:通知失败 3：账户余额不足 |
| data.timeOut | 整数 | 订单有效时间（分钟） |
| data.date | 整型 | 订单创建时间时间戳（13位） |


# **<u>查询订单信息</u>**
#### ● **请求地址**
https://epay.jylt.cc/api/getOrder

#### ● **请求方式**
POST/GET

#### ● **参数说明**
| **参数** | **参数类型** | **参数说明** |
| --- | --- | --- |
| orderId | 字符串 | 【必传】云端订单号，创建订单返回的 |
| mchId | 字符串 | 【必传】商户号 |


#### ● **返回数据（示例）**
```plain
{
    "code": 1,
    "msg": "成功",
    "data": {
        "payId": "1547129707139",
        "orderId": "201901102220147500",
        "payType": 2,
        "price": 0.1,
        "reallyPrice": 0.1,
        "payUrl": "HTTPS://QR.ALIPAY.COM/FKX03500Z2ZYWA0ELYUB5D",
        "isAuto": 1,
        "state": 0,
        "timeOut": 5,
        "date": 1547130014777
    }
}
```

#### ● **返回数据说明**
| **返回参数** | **参数形式** | **说明** |
| --- | --- | --- |
| code | 整数 | 返回代码（1：成功，-1：调用失败） |
| msg | 字符串 | api调用结果说明 |
| data | array | 如果code=-1，data为null |
| data.payId | 字符串 | 商户订单号 |
| data.orderId | 字符串 | 云端订单号，可用于查询订单是否支付成功 |
| data.payType | 整数 | 微信支付为1 支付宝支付为2 |
| data.price | 小数 | 订单金额 |
| data.reallyPrice | 小数 | 实际支付金额 |
| data.payUrl | 字符串 | 支付二维码内容 |
| data.isAuto | 整数 | 1需要手动输入金额 0扫码后自动输入金额 |
| data.state | 整数 | -1：订单过期 0：等待支付 1：支付成功 |
| data.timeOut | 整数 | 订单有效时间（分钟） |
| data.date | 整型 | 订单创建时间时间戳（13位） |


# **<u>查询订单状态</u>**
#### ● **请求地址**
https://epay.jylt.cc/api/checkOrder

#### ● **请求方式：**
POST/GET

#### ● **参数说明**
| **参数** | **参数类型** | **参数说明** |
| --- | --- | --- |
| orderId | 字符串 | 【必传】订单号，创建订单返回的 |
| mchId | 字符串 | 【必传】商户id |


#### ● **返回数据（示例）**
```plain
{
    "code": 1,
    "msg": "成功",
    "data": "https://test.com/?payId=1547130880571¶m=vone666&type=2&price=0.1&reallyPrice=0.1&sign=c79f041bd5bc47d73bc19dc8406c9843"
}
```

#### ● **返回数据说明**
| **返回参数** | **参数类型** | **参数说明** |
| --- | --- | --- |
| code | 整数 | 1：订单已被支付，-1：支付失败，-2：订单未支付；-3：订单已过期 |
| msg | 字符串 | 调用结果说明 |
| data | 字符串 | 如果code为-1，则data为null，否则为该订单支付完成后的跳转地址（带回调参数） |


# **<u>生成签名</u>**
#### ● **请求地址**
https://epay.jylt.cc/api/generateSign

#### ● **请求方式：**
POST/GET

#### ● **参数说明**
| **参数** | **参数类型** | **参数说明** |
| --- | --- | --- |
| param | 字符串 | 【必传】生成签名所需的字符串(payId+param+type+price+通讯密钥)（注：该字符串不需要进行md5加密，直接使用即可） |


#### ● **请求示例**
| 参数名 | 参数值 |
| :--- | :--- |
| payId | 2023091239201001 |
| param | uid:12 |
| type | 2 |
| price | 0.01 |
| 通讯密钥 | 123123 |


#### ● **返回数据（示例）**
```plain
{
    "code": 1,
    "msg": "成功",
    "data": "698d51a19d8a121ce581499d7b701668",
    "success": true,
    "error": -1
}
```

#### ● **返回数据说明**
| **返回参数** | **参数类型** | **参数说明** |
| --- | --- | --- |
| code | 整数 | 1：成功；其他：失败 |
| data | 字符串 | 生成的签名 |


# **<u>回调参数说明</u>**
当系统收到用户收款后，将会向您后台设定的异步通知地址发送GET请求，通知您的服务端订单完成收款

若您使用的是isHtml=1，则在支付完成后会携带参数跳转到您的同步通知接口（同时会向您设置的异步通知地址发送GET请求），若使用isHtml=0则只有异步通知

传输参数（示例）：mchId=1547130349673&payId=1547130349673&param=vone666&type=2&price=0.1&reallyPrice=0.1&sign=28943820b95019b6a63598a13c46f93f

● 注意：您的回调接口收到易支付请求之后，需要返回字符串 "success"，这样易支付才会将订单里的状态设置为成功，否则会提示“通知失败”

● 如果回调开发者服务失败，易支付对订单的回调通知url最多进行7次确认通知，分别间隔 1/5/10/30/60/180/360 分钟，开发者需要在回调接口中做好通知去重逻辑

#### ● 传输参数说明
| **返回参数** | **参数类型** | **参数说明** |
| --- | --- | --- |
| mchId | 字符串 | 商户id |
| orderId | 字符串 | 云端订单号 |
| param | 字符串 | 创建订单的时候传入的参数 |
| type | 整数 | 支付方式 ：微信支付为1 支付宝支付为2 |
| price | 小数 | 订单金额 |
| reallyPrice | 小数 | 实际支付金额 |
| sign | 字符串 | 校验签名，计算方式 = md5(orderId + param + type + price + reallyPrice + 通讯密钥) |


# **开发流程图**
## **isHtml参数为0**
<!-- 这是一张图片，ocr 内容为： -->
![](https://cdn.nlark.com/yuque/0/2026/png/1252193/1769926702281-ac77002a-194d-48b0-8ecf-ee29af58b9f6.png)

## **isHtml参数为1**
<!-- 这是一张图片，ocr 内容为： -->
![](https://cdn.nlark.com/yuque/0/2026/png/1252193/1769926726492-bf5077fd-43de-446e-940a-bc6e27b1719d.png)

## **正确流程**
用户点击购买商品，开发者生成payId，然后跳转到支付页面选择支付方式，用户选择支付方式之后，开发者请求创建订单接口，获取订单支付信息。

如果isHtml=0，需要在页面展示商品名称、支付二维码、实际支付金额（reallyPrice）、订单过期时间。然后开发者可以查询订单状态，用户支付成功后提示用户支付成功。

**注意：要格外提示用户金额不能输入错误，并且在订单过期之后要隐藏二维码，防止用户支付，可提示用户重新下单。**

如果isHtml=1，开发者请求创建订单之后，易支付会返回开发者系统支付地址的url，开发者可通过 window.location.href 方式跳转到系统支付页面，用户支付成功后，易支付会自动跳转到开发者填写的同步回调地址。

## **错误流程**
用户点击购买商品，开发者生成payId，同时调用创建订单接口。用户还没有选择支付方式，可能没有购买意愿，导致易支付生成大量废单，会导致实收和应收金额有一定出入，不利于用户体验。

# **Java sdk**
[<u>https://gitee.com/gitwcx/epay-sdk-java</u>](https://gitee.com/gitwcx/epay-sdk-java)

# **MD5工具类**
## **java版**
1. 如果您使用的是Spring框架

```plain
DigestUtils.md5DigestAsHex(str.getBytes())
```

1.  如果您没有使用Spring框架

```plain
public static String md51(String text) throws NoSuchAlgorithmException {
    char[] HEX_CHARS = new char[]{'0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'};
    MessageDigest messageDigest = MessageDigest.getInstance("MD5");
    byte[] digest = messageDigest.digest(text.getBytes());

    char[] chars = new char[32];

    for(int i = 0; i < chars.length; i += 2) {
        byte b = digest[i / 2];
        chars[i] = HEX_CHARS[b >>> 4 & 15];
        chars[i + 1] = HEX_CHARS[b & 15];
    }
    return new String(chars);
}
```

