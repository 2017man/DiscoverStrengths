# 前端接口对接检查记录

> 生成时间：2025-02-02  
> 用于记录前端页面中写死的数据、未对接的接口，供后端开发参考。

---

## 一、已完成对接的接口

| 页面 | 接口 | 状态 |
|------|------|------|
| 首页 index.vue | `GET /test-types/list` | ✅ 已对接 |
| MBTI 说明页 intro.vue | `GET /mbti/intro` | ✅ 已对接 |
| MBTI 答题页 questions.vue | `GET /mbti/questions` | ✅ 已对接 |
| MBTI 答题页 questions.vue | `POST /mbti/submit` | ✅ 已对接 |
| MBTI 结果页 result.vue | `GET /mbti/report?result_id=xxx` | ✅ 已对接 |
| 支付页 pay.vue | `GET /mbti/report?result_id=xxx`（取 price） | ✅ 已对接 |
| 支付页 pay.vue | `POST /order/create` | ✅ 已对接 |
| 报告页 report.vue | `GET /mbti/report?result_id=xxx` | ✅ 已对接 |
| 报告页 report.vue | `GET /mbti/report/pdf?result_id=xxx` | ✅ 已对接 |
| 首页 index.vue | `GET /config/site`（stats_count、stats_date、qrcode） | ✅ 已对接 |
| MBTI 答题页 questions.vue | SECTION_CONFIG 从 `GET /mbti/questions` 的 sections 动态生成 | ✅ 已对接 |

---

## 二、写死 / 无接口的数据

### 2.1 支付页 pay.vue

| 项 | 说明 | 建议 |
|----|------|------|
| 默认 price `8.88` | data 初始值，接口成功后会覆盖 | 可保留作兜底，接口返回 price 会覆盖 |

### 2.2 报告页 report.vue

| 项 | 说明 | 建议 |
|----|------|------|
| MOCK_REPORT 初始值 | 接口加载前展示的默认数据，接口成功后会覆盖 | 可保留作骨架屏/兜底 |
| DIMENSION_TOPIC_TITLES | 第 2 部分维度标题 fallback | 接口返回 dimensions.dimension_scope 时不用 |
| DIMENSION_TRAIT_DETAIL | 八个面（E/I/S/N/T/F/J/P）的详细文案 fallback | 接口返回 dimensions_detail 时不用 |
| REPORT_SUBTITLES | 副标轮换「你的优势，值得被看见」等 | 可保留前端随机，或由接口返回 |
| 温馨寄语 warmQuote | 来自 `common/growth_quotes.js` 本地库 | 可保留前端，或新增接口返回 |
| qrcode_wechat / qrcode_community | 报告接口可选返回 | 后端 mbti/report 已支持，有则展示 |

### 2.3 结果页 result.vue

| 项 | 说明 | 建议 |
|----|------|------|
| MOCK_RESULT 初始值 | 接口加载前展示，接口成功后会覆盖 | 可保留作兜底 |
| RESONANCE_SENTENCES | 共鸣句库（3 条随机） | **前端随机返回**，暂不接接口 |
| price `9.9` | MOCK 中的默认值 | 接口返回 price 会覆盖 |

### 2.4 首页 index.vue

| 项 | 说明 | 建议 |
|----|------|------|
| ASSESSMENT_LIST_FALLBACK | 接口失败时兜底 4 卡片 | 可保留 |
| stats_count / stats_date / qrcode | 已由 `GET /config/site` 返回 | 需后端实现该接口 |

### 2.5 MBTI 说明页 intro.vue

| 项 | 说明 | 建议 |
|----|------|------|
| DIMENSIONS | 四个维度完整内容（概述、关键词、倾向于） | 写死在前端 | 可保留，或由 `GET /mbti/intro` 扩展返回 |
| TYPE_LIST | 十六种类型 code/name/desc | 写死 | 可保留，或由接口返回 |
| DIAGRAM_GRID 等 | 4×4 维度示意图数据 | 写死 | 可保留 |

### 2.6 MBTI 答题页 questions.vue

| 项 | 说明 | 建议 |
|----|------|------|
| SECTION_CONFIG | 四个部分的题号范围、引导语 | 已从 `GET /mbti/questions` 的 sections 动态生成 |
| MOCK_QUESTIONS / SECTION_CONFIG_FALLBACK | 接口失败时兜底 | 可保留 |

### 2.7 分享功能

| 页面 | 说明 | 建议 |
|------|------|------|
| report.vue onShare | 点击「分享给朋友」仅 toast「分享功能将在接口绑定后开放」 | **无接口** | 若需分享，可接微信 JSSDK 或生成分享卡片 |

---

## 三、建议后端新增/扩展的接口

| 接口 | 路径 | 说明 |
|------|------|------|
| 站点配置 | `GET /config/site` | 返回 stats_count、stats_date、qrcode_wechat、qrcode_community，供首页使用；**前端已对接**；数据来自 `strengths_site_config` 表 |
| 共鸣句 | 可放在 `GET /mbti/report` 或单独接口 | 结果页共鸣句，当前为前端随机 3 条，暂不接接口 |

---

## 三附、数据库脚本检查

详见 `docs/database/数据库脚本检查记录.md`。建表脚本已补充：`strengths_site_config` 表；`strengths_test_types.estimate_minutes`；`strengths_test_answer.suggestion`。

---

## 四、支付流程说明（易支付）

- 前端：支付页调用 `POST /order/create`，获取 `pay_url` 后 `window.location.href = pay_url` 跳转易支付
- 测试免支付：后端返回 `skip_payment: true` 时，前端直接跳转报告页
- 支付成功：易支付异步回调后端，后端更新订单与 `is_paid`；同步跳转由 `EPAY_RETURN_URL` 配置

---

## 五、PDF 下载说明

- 前端已对接：`GET /mbti/report/pdf?result_id=xxx`
- 未付费时前端会提示「请先解锁完整报告」
- 后端需：已付费返回 PDF 文件流（Content-Type: application/pdf，Content-Disposition: attachment），未付费返回 403

---

## 六、测试环境完整报告（full=1）

- **前端**：访问 `report?result_id=xxx&full=1` 或 `report?result_id=xxx&test=1` 时，会向接口附带 `full=1`，并强制视为已付费（不跳转支付页）。
- **后端**：建议 `GET /mbti/report?result_id=xxx&full=1` 时，即使未付费也返回完整结构化字段（dimension_scores、dimensions_detail、traits、strengths、weaknesses 等），便于联调与演示。
