# 《发现你的天赋优势》前端开发文档

## 一、技术栈与工程结构

| 项目 | 说明 |
|------|------|
| **框架** | uni-app（Vue 2），H5 与 Web 双端兼容 |
| **UI** | uview-ui、ColorUI（colorui/main.css、icon.css、animation.css） |
| **请求** | 封装在 `common/request.js`，挂载为 `this.$http` |
| **全局样式** | App.vue 中引入 uni.scss、uni.css、customicons；`:root` 定义 `--primary-color: #bd1a2d` |

### 目录结构（与本期相关）

```
pages/h5/evaluate/          # 测评相关页面（来自旧项目，本期需重新设计）
  ├── index.vue             # 首页/测评入口（接口调用方式可参考，页面风格需重做）
  ├── minyi_index.vue        # 民意调查（旧项目保留，不作为本期视觉参考）
  └── components/
      └── PageHeader.vue     # 页面头部组件（可参考结构，样式需按本期风格重设计）
common/
  ├── request.js             # 请求封装（必读，接口调用方式可直接沿用）
  ├── growth_quotes.js       # 成长名言/暖心文案（报告用）
  └── util.js                # 工具函数
colorui/                     # ColorUI 样式与组件（可按需使用，结合本期风格）
```

**说明**：`pages/h5/evaluate/` 下现有页面为**旧项目**（民主评议等）的页面，**接口调用方式、请求封装、路由跳转等可参考沿用**；**本期「发现你的天赋优势」MBTI 的页面风格与视觉需重新设计**，不沿用旧项目 UI，详见下文「页面风格与设计原则」。

---

## 二、接口调用方式（参考 request.js）

### 2.1 封装说明

- **基础地址**：开发环境 `http://collect.com/api/v1`，线上在 `request.js` 顶部配置 `apiUrl`。
- **调用方式**：`this.$http.sendRequest(url, method, data)`，返回 `Promise`。
- **URL 规则**：传入相对路径，如 `'test-types/list'`，内部拼成 `baseUrl + '/' + url`。
- **请求头**：自动带 `Content-Type`、`Authorization`（从 `uni.getStorageSync('token')` 读取）。

### 2.2 调用示例（接口调用方式可参考 pages/h5/evaluate 下现有页面的写法）

```javascript
// GET
this.$http.sendRequest('test-types/list', 'GET', {}).then(res => {
  if (res.data.code === 200) {
    // res.data.data
  } else {
    this.$http.errorToast(res, null, false);
  }
}).catch(err => {
  uni.showToast({ icon: 'error', title: err.errorMessage || '请求失败' });
});

// POST（application/json 或 application/x-www-form-urlencoded）
// 答案格式与接口文档一致：answers 为 { question_number, option_key } 数组，MBTI 共 93 题
this.$http.sendRequest('mbti/submit', 'POST', {
  answers: [
    { question_number: 1, option_key: 'A' },
    { question_number: 2, option_key: 'B' }
    // ... 按题号顺序，共 93 题
  ]
}).then(res => {
  if (res.data.code === 200) {
    const resultId = res.data.data.result_id;
    // 跳转结果页，带 result_id
  }
});

// 创建订单：传 result_id，后端返回 pay_url、out_trade_no（可选 epay_order_id）；skip_payment 为 true 时直接跳转报告页
this.$http.sendRequest('order/create', 'POST', { result_id: 1001 }, 'application/json');
// 成功后可：若 data.skip_payment 则跳转报告页；否则跳转 data.pay_url；若展示二维码则保存 data.out_trade_no 并轮询 GET order/check-payment?out_trade_no=xxx
```

### 2.3 统一响应约定（与接口文档一致）

- **成功**：`res.data.code === 200`，业务数据在 `res.data.data`，提示在 `res.data.msg`。
- **业务错误**：`res.data.code >= 10000`，用 `this.$http.errorToast(res)` 弹窗。
- **401/403**：request.js 内部会清 token 并提示重新登录。

---

## 三、页面风格与设计原则（本期必读）

本期「发现你的天赋优势」MBTI 的页面**需重新设计**，不沿用旧项目视觉。目标风格如下。

### 3.1 整体风格定位

- **大气**：留白充足、版块清晰、主次分明；避免拥挤、堆砌，让用户一眼能抓住重点。
- **简洁**：信息层级清楚，操作路径短；少装饰、少干扰，每一处元素都有存在理由。
- **有质感**：字体、间距、圆角、阴影、动效等细节统一且克制，整体观感专业、可信。
- **用心**：从首屏到报告页，体验连贯、反馈及时、文案温暖；让用户感到「这个产品是认真做的」。

### 3.2 设计落地建议

| 维度 | 建议 |
|------|------|
| **排版** | 标题与正文层级分明，字号、字重、行高统一；适当留白，避免满屏字。 |
| **色彩** | 主色可沿用或微调（如 `--primary-color`）；背景以浅色/白为主，局部用色块或渐变增强氛围，不花哨。 |
| **卡片与模块** | 测评卡片、题目区块、报告模块等用卡片或分割线区分；圆角、阴影适度，风格统一。 |
| **按钮与交互** | 主按钮醒目但不刺眼；加载、提交、跳转有明确反馈（loading、toast）；动效轻量、不抢戏。 |
| **文案** | 标题、说明、按钮文案简洁有力；报告与引导语可带温度，与「成长陪伴」定位一致。 |

以上为方向性要求，具体视觉规范（如设计稿、组件库）可由设计/前端在开发前再细化，但**大气、简洁、有质感、用心**应贯穿所有页面。

### 3.3 与运营规划、参考站对齐

**网站意图与目的**（见《运营规划》）：

- **产品定位**：发现你的天赋优势；网站是**工具和入口**，真正目标是帮助更多人解决困境与迷茫、与用户一起成长。
- **产品调性**：有温度、可信、专业、易上手；差异化在于**有温度的成长陪伴**，而非单纯卖报告。
- **主 Slogan**：发现天赋，迈出第一步。
- **副标（轮换）**：你的优势，值得被看见 / 天赋是起点，成长是旅程（用于落地页、报告页等增加温度）。

**UI 与交互参考**：[TalentSays.com](https://www.talentsays.com/index.html)

- **版式**：浅色顶栏、首屏主标语 + 测试总人次/日期、区块标题中英双行（如「个人测评 PERSONAL ASSESSMENT」）、测评卡片网格 + 明确「进入」按钮。
- **风格**：简洁、留白、白底/浅灰背景、卡片轻阴影与细边框、主色用于按钮与重点信息；整体专业、易读。
- **交互**：分区清晰、CTA 明确（进入 / 开始答题 / 解锁完整报告）；流程短、反馈及时（loading、toast）。

**文案与触点约定**（与运营规划一致）：

| 页面/位置 | 约定 |
|-----------|------|
| 首页/落地页 | 主 Slogan + 副标轮换，简洁大气；便于 SEO 与认知阶段触达。 |
| 结果预览页 | 共鸣句（如「很多人和你一样……」）+ 暖心文案；引导「解锁完整报告」。 |
| 完整报告页 | 温馨寄语、成长名言；报告末尾公众号/社群引流（二维码预留位）。 |
| 错误/空状态 | 用暖心话替代冷冰冰的「加载失败」等。 |

前端实现时：首页已采用主 Slogan + 副标轮换；结果页、报告页在接口绑定后可接入共鸣句与成长名言（可复用 `common/growth_quotes.js` 或接口数据）。

---

## 四、Web 端与 H5 端兼容

站点需同时兼容 **Web 端（桌面浏览器）** 与 **H5 端（手机浏览器）**，同一套代码在两种环境下均可正常使用。

### 4.1 布局与断点

| 场景 | 处理方式 |
|------|----------|
| **Web 大屏（宽度 ≥ 751px）** | 页面根容器使用类名 `page-wrap-web`，全局样式中限制 `max-width: 750px`、居中并加轻微阴影，避免桌面端内容过宽，呈现「居中卡片」效果。 |
| **H5 / 小屏（宽度 &lt; 751px）** | 不限制最大宽度，内容按 100% 宽度与 rpx 自适应，保持移动端全屏体验。 |

所有测评相关页面的根节点已统一添加 `page-wrap-web`，无需再单独写媒体查询。

### 4.2 交互

- **H5**：依赖 `:active`、点击区域足够大，保证触控友好。
- **Web**：为主要按钮、卡片等可点击元素增加 `:hover` 状态（如透明度、阴影），提升鼠标操作反馈。

### 4.3 安全区域（刘海屏等）

- **PageHeader**：顶部预留 `safe-area-inset-top`，避免与刘海/状态栏重叠。
- **答题页底部栏**：预留 `safe-area-inset-bottom`，避免与 Home 条重叠。
- 其他需贴边布局的固定栏，可按需使用全局类 `safe-area-top` / `safe-area-bottom` 或自行写 `env(safe-area-inset-*)`。

### 4.4 开发注意

- 新页面若需同时适配 Web 与 H5，根容器请加上 `page-wrap-web`。
- 主要可点击元素建议同时写 `:hover`（Web）与 `:active`（H5），保证两端体验一致。

---

## 五、组件引入与使用（结构可参考，样式按本期风格重做）

### 5.1 页面内组件

组件**引入方式**可参考现有页面（如 `pages/h5/evaluate/index.vue`），**视觉与布局按本期风格重新实现**：

```javascript
import PageHeader from "./components/PageHeader.vue";

export default {
  components: { PageHeader },
  // ...
};
```

```html
<PageHeader />
```

### 5.2 公共组件（ColorUI / uview）

- **ColorUI**：在 App.vue 已全局引入样式；可按需使用类名，但**整体风格需服从本期「大气、简洁、有质感」**，必要时覆盖或封装成统一组件。
- **uview**：main.js 中 `Vue.use(uView)`，可直接使用 `<u-button>`、`<u-empty>`、`<uni-loading>` 等；若与本期风格冲突，可做主题覆盖或封装一层。

### 5.3 头部与通用组件

- **PageHeader**：当前为旧项目样式；本期建议改为 props 传入 `title`、`subtitle`，样式**重设计**为简洁、留白充足，与首页、说明页、报告页统一。
- **MBTI 相关文案**：如「发现你的天赋优势」「MBTI 职业性格测试」等，可按路由/页面配置或 props 传入，便于统一调整。

---

## 六、前端页面清单（v1.0 MBTI）

| 页面 | 路径（建议） | 说明 |
|------|----------------|------|
| 首页 | `pages/h5/evaluate/index` | 4 个测评卡片（MBTI 可点，霍兰德/DISC/职业锚灰色「即将上线」） |
| MBTI 说明页 | `pages/h5/evaluate/mbti/intro` | 测试说明、题数、时长、开始答题按钮 |
| MBTI 答题页 | `pages/h5/evaluate/mbti/questions` | 题目列表/单题切换、选项、进度、提交 |
| MBTI 结果预览页 | `pages/h5/evaluate/mbti/result` | 约 30% 免费预览 +「解锁完整报告」按钮 |
| MBTI 完整报告页 | `pages/h5/evaluate/mbti/report` | 付费后完整内容 + PDF 下载入口 |
| 支付页 | `pages/h5/evaluate/pay` | 易支付跳转或中间页（金额从接口取） |
| 我的测试记录 | `pages/h5/evaluate/records` | 可选 v1.0；列表 + 跳转报告 |
| 订单详情 | `pages/h5/evaluate/order` | 可选 v1.0 |

上述页面的**交互与接口逻辑**可参考现有 pages 的写法；**视觉与版式需按本期「大气、简洁、有质感、用心」重新设计**，不直接沿用旧项目 UI。

### 6.1 路由与参数约定

- **首页**：无需参数。
- **说明页**：`/pages/h5/evaluate/mbti/intro` 或带 `?type=mbti`。
- **答题页**：可从说明页跳转；提交后得到 `result_id`，再跳结果页。
- **结果/报告页**：`?result_id=xxx`；报告页根据「是否付费」显示完整或引导支付。
- **支付页**：`?result_id=xxx`，金额由创建订单接口返回或从测试类型配置读取；后端从 result_id 查 strengths_test_results_records 得 test_type。

---

## 七、数据与状态（答题过程）

- **匿名答题**：可不登录；用 `uni.setStorageSync('mbti_answers', [...])` 暂存答案（格式为 `[{ question_number, option_key }, ...]`），提交时一并上传。
- **防重复付费**：同一 openID + 测试类型（test_type，如 MBTI）已付费时，接口返回「已解锁」，前端直接进完整报告。
- **微信 openID**：H5 内如需微信授权，由后端提供授权 URL 或前端使用微信 JS-SDK；获取后存 storage 或随支付回调由后端绑定。

---

## 八、与接口文档、数据库的对应关系

- **测试类型列表**：调用「测试类型列表」接口，展示 4 卡片；`status` 或 `is_available` 控制是否可点。
- **题目列表**：调用「MBTI 题目列表」，按 `question_number` 排序展示（共 93 题）；选项用返回的 `options` 数组（每项含 `key`、`text`、`side`，side 为维度面 E/I/S/N/T/F/J/P）。
- **提交答案**：调用「MBTI 提交答案」，传 `answers: [{ question_number, option_key }, ...]`（与接口文档一致）；返回 `result_id`、`result_code`（如 INTJ）、预览内容等。
- **报告是否付费**：调用「报告详情」或「订单状态」，若已付费则展示完整报告，否则展示预览 + 支付按钮。
- **支付**：调用「创建订单」获取易支付参数（pay_url、out_trade_no）；跳转 pay_url 完成支付。若为**跳转支付页**（易支付 isHtml=1），支付完成后易支付会跳回 EPAY_RETURN_URL，前端报告页加载时调 `GET /mbti/report` 或 `GET /order/status` 即可拿到最新 is_paid。若为**展示二维码**（isHtml=0），前端需保存 out_trade_no，定时轮询 `GET /order/check-payment?out_trade_no=xxx`，当返回 `paid === true` 时提示支付成功并跳转报告页。详见《接口文档》5.4。

---

## 九、开发前准备检查

- [ ] 阅读 `common/request.js`，确认 `apiUrl`、环境切换方式；**接口调用方式可参考现有 pages**。
- [ ] 明确本期**页面风格**：大气、简洁、有质感、用心；现有 `index.vue`、`PageHeader.vue` 等**仅作接口与结构参考，视觉需重设计**。
- [ ] 在 `pages.json` 中注册上述新页面路径。
- [ ] 与后端约定接口 basePath（如 `/api/v1`）及统一响应格式（见《接口文档》）。
- [ ] 素材：MBTI 题目与人格特点以「接口数据」为准；若需本地兜底，可参考 `素材/MBTI题库和答案/` 中 CSV 结构（需后端或脚本导入库）。

---

## 十、相关文档

| 文档 | 说明 |
|------|------|
| [接口文档](./接口文档.md) | 请求路径、参数、响应格式 |
| [数据库设计](./数据库设计.md) | 表结构，便于理解接口字段 |
| [后端开发文档](./后端开发文档.md) | 后端逻辑与对接说明 |
